.data 
POSICAO_SORVETE: .half 64,64
ANTIGA_POS_SORVETE: .half 64,64
.include "background.data"
.include "frente1.data"

.text
SETUP:		la a0, background
		li a1, 0
		li a2, 0
		li a3, 0
		call PRINT
		# a0 = endere√ßo da imagem
		# a1 = x (coluna)
		# a2 = y (linha)
		# a3 = frame (0 ou 1)
		# t0 = endere√ßo do bitmap display
		# t1 = endere√ßo da img
		# t2 = contador da linha
		# t3 = contador da coluna
		# t4 = largura
		# t5 = altura
		
GAME_LOOP:	call TECLA_PRESS #chama o procedimento que verifica se a tecla est· sendo pressionada
		xori s0,s0,1 #alternador de frames
		la t0,POSICAO_SORVETE
		la a0, frente1 # gera√ß√£o do personagem
		lh a1,0(t0)
		lh a2,2(t0)
		mv a3,s0
		call PRINT
		
		li t0,0xFF200604
		sw zero,0(t0)
		j GAME_LOOP
		
TECLA_PRESS:	li t1,0xFF200000	# carrega o endereÁo de controle do KDMMIO
		lw t0,0(t1)			# Le bit de Controle Teclado
		andi t0,t0,0x0001		# mascara o bit menos significativo
	   	beq t0,zero,RETURN   	   	# Se n„o h· tecla pressionada ent„o vai para FIM
	  	lw t2,4(t1)  			# le o valor da tecla tecla
		
		li t0,'w'
		beq t2,t0,ANDA_CIMA #se a tecla pressionada for w, anda para cima
		li t0,'s'
		beq t2,t0,ANDA_BAIXO #se a tecla pressionada for s, anda para baixo
		li t0,'a'
		beq t2,t0,ANDA_ESQ #se a tecla pressionada for a, anda para esquerda
		li t0,'d'
		beq t2,t0,ANDA_DIR #se a tecla pressionada for d, anda para a direita
				
RETURN: 	ret

ANDA_CIMA:

		la t0,POSICAO_SORVETE
		#la t1,ANTIGA_POS_SORVETE cÛdigo para salvar a antiga posiÁ„o do personagem e substituÌla por um recorte do fundo
		#lw t2,2(t0)
		#sw t2,2(t1)
		
		lh t1,2(t0)
		addi t1,t1,-8
		sh t1,2(t0)
		ret				# retorna

ANDA_BAIXO:	la t0,POSICAO_SORVETE
		lh t1,2(t0)
		addi t1,t1,8
		sh t1,2(t0)
		ret
		
ANDA_DIR:	la t0,POSICAO_SORVETE
		lh t1,0(t0)
		addi t1,t1,8
		sh t1,0(t0)
		ret
		
ANDA_ESQ:	la t0,POSICAO_SORVETE
		lh t1,0(t0)
		addi t1,t1,-8
		sh t1,0(t0)
		ret
		
						
PRINT:		li t0, 0xFF0
		add t0, t0, a3
		slli t0, t0, 20
		add t0, t0, a1
		
		li t1, 320
		mul t1, t1, a2
		add t0, t0, t1
		addi t1, a0, 8
		# defini√ß√£o do endere√ßo da imagem
		
		#zerando os contadores
		mv t2, zero 
		mv t3, zero
		
		# defini√ß√£o da largura e da altura
		lw t4, 0(a0)
		lw t5, 4(a0)
		
PRINT_LINHA:	lw t6, 0(t1)
		sw t6, 0(t0) # carrega o pixel na imagem
		
		addi t1, t1, 4 # vai pro proximo pixel
		addi t0, t0, 4
		
		addi t3, t3, 4 # incrementa o contador de coluna
		
		blt t3, t4, PRINT_LINHA # verifica se terminou de desenhar a linha
		
		addi t0, t0,  320 # pula p proxima linha
		sub t0, t0, t4 
		
		mv t3, zero # zero o contador de coluna
		addi t2, t2, 1 # 3 incrementa o contador de linha
		bgt t5, t2, PRINT_LINHA
		ret
